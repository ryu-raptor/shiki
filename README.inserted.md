---
title: 四季マニュアル
author: ryu-raptor
---

四季 (shiki) inserts "aki"s in your plain text for typography.

四季は和欧混文にアキを挿入して簡単なタイポグラフィを実現します．

[`README.inserted.md`](README.inserted.md) はテキストを四季で処理したものです．

# はじめに
コンピュータで平文テキストを記述する際に欧文と和文の間にスペースを入れる習慣があります．
これは平文として呼んだときの見栄えを考えて行われることで，LaTeX のような組版を行うソフトウェアならそのようなアキを自動で挿入します．

スペースの挿入は見栄えやキーワード補完の際に役立ちますが，文意とは関係なく，スタイルと内容を分離するという原則に反します（たとえば，LaTeX はこのようなスペースを内容だと解釈するため，自動アキ挿入に問題が生じます）．

四季はスペースを挿入せずに記述した平文テキストに後で適切にスペースを挿入することでこの問題を解決します．
つまり，書くときにはスペースを入れずに書いて，公開の際に見た目を調整するスペースを入れるといったことができます．

Jekyll などのデプロイの際にこの処理を行えば，ローカルの Markdown をスペースクリーンにすることができます．

# インストール
luarocks を利用してインストールできます．

```
luarocks install shiki
```

# 使い方

これだけです．

```
aki your_input_plain_text_files ...
```

入力をすべてまとめて変換し，標準出力に結果を出力します．

ファイルに出す場合は`tee`などと組み合わせてください．
```
aki your_input_plain_text_files ... | tee output_file
```

# 挿入ルール
現在の仕様は次のとおりです．

- 和文（ひらがな，カタカナ，漢字）と英語のアルファベット，半角アラビア数字，半角約物（後述）の間にスペースを入れる．
- 和文に続く半角横書き句読点に適切なスペースを挿入する．

詳細なルールは以下の通り

## 和文側
和文側とは
```
こんにちは Hello, World 世界
```

```
こんにちは]Hello, World[世界
```
この"`] `"，"` [`"の開いている方を指します．アルファベットでは「間」という用語で問題ありませんが，約物ではそうは行かないため予め定義しておきます．

## アルファベット
現在アキュートなどの付点つきやギリシャ文字，キリル文字はサポートしていません．

単純にスペースを挿入します．Microsoft のドキュメントなどでは特殊なルール分けがありますが，LaTeX ではそのようなことがないためこの際無視します．

## 約物
全角約物は無視します．プロポーショナルフォントがうまくやってくれることを信じています．なお，全角約物は通常既にスペースがあるため，和文ではないとします．

例えば，
```
単純にスペースを挿入します．_Microsoft では異なります．
```
"`_`"にアキは入れません．

次の例の"`_`"にもアキは入りません．
```
つまり，_LaTeX はアキを入れてくれます．
```

次の半角約物を処理します．
```
,.()[]{}
```

以降"`_`"は挿入されるアキを意味します．

### 1. カッコ類
和文側にアキがない場合は挿入します．
```
スペース (Space) は空白を意味する．
```

は次のようにアキが入ります．
```
スペース_(Space)_は空白を意味する．
```

欧文側にはスペースが入りません．多くの場合これは望ましい挙動です．
以下のようにはならない．
```
スペース_(_Space_)_は空白を意味する．
```

### 2. 句読点類
句読点の後にスペースを挿入します．既に挿入されている場合は無視します．

```
つまり,LaTeX はアキを入れてくれます．
```

は次のようになります．
```
つまり,_LaTeX はアキを入れてくれます．
```

文末（改行文字・終端文字）の場合は挿入しません．

## しないこと
混乱を避けるために明示的にしないことの例を示します．

### 欧文同士の処理
欧文の周りのいかなる約物についても，処理しません．

現状の仕様では，和文があればプログラムのような場合であっても約物の配置次第では処理します．

```
print("こんにちは, 世界") ;
```

プログラムはカンマのあとにスペースを入れないことを意図していますが，
```
print("こんにちは,_世界") ;
```
スペースが挿入されてしまいます．

このバグの対策はこれから考えることとします．


# これからの予定
- スペースではなく，任意のマークアップ要素（`<span>`など）で欧文を囲って，後ほど CSS 等で調整できるようにするオプションの追加．
    `aki --enclose '<span class="shiki-aki">'`などを予定

